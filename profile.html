<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Profil trenÃ©ra</title>
  <link rel="stylesheet" href="style_main.css"/>
</head>
<body>
  <nav class="navbar">
    <div class="nav-logo">
      <a href="index_main.html"><img src="CZtrainers new better.png" alt="CZTRAINERS Logo" /></a>
      <!--<img src="CZtrainers new better.png" alt="CZTRAINERS Logo" style="height: 60px;" />-->
    </div>

    <button class="hamburger" id="hamburger">&#9776;</button>

    <div class="nav-links" id="navLinks">
      <a href="index_main.html" class="nav-button">DomÅ¯</a>
      <div id="authButtons">
        <a href="index.html" class="nav-button" id="registerBtn">Registrace</a>
        <a href="login.html" class="nav-button" id="loginBtn">PÅ™ihlÃ¡Å¡enÃ­</a>
      </div>
      <a href="mujprofil.html" class="nav-button" id="profileBtn" style="display: none;">MÅ¯j profil</a>
      <a href="#" class="nav-button" id="logoutBtn" style="display: none;">OdhlÃ¡sit se</a>
      <a href="o-nas.html" class="nav-button">O nÃ¡s</a>
      <button class="theme-toggle nav-button" id="themeToggle"><span id="themeIcon">â˜€ï¸</span></button>
    </div>
  </nav>

  <div class="container">
    <h1>Profil uÅ¾ivatele</h1>
    <div id="profileCard" class="profilecard"></div>
  </div>

  <!-- THEME SCRIPT -->
  <script>
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark');
    }

    window.addEventListener('DOMContentLoaded', () => {
      const themeToggle = document.getElementById('themeToggle');
      const icon = document.getElementById('themeIcon');

      function updateTheme(isDark) {
        document.body.classList.toggle('dark', isDark);
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        icon.textContent = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
      }

      if (localStorage.getItem('theme') === 'dark') {
        icon.textContent = 'ğŸŒ™';
      }

      themeToggle.addEventListener('click', () => {
        const isDark = !document.body.classList.contains('dark');
        updateTheme(isDark);
      });

      document.getElementById("hamburger").addEventListener("click", function () {
        document.getElementById("navLinks").classList.toggle("active");
      });
    });
  </script>

  <!-- FIREBASE + PROFILE SCRIPT -->
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyASK2terL9kejt9JTJr944WCFYzRkK8AGU",
    authDomain: "cztrainers-dat1.firebaseapp.com",
    databaseURL: "https://cztrainers-dat1-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "cztrainers-dat1",
    storageBucket: "cztrainers-dat1.appspot.com",
    messagingSenderId: "369200533487",
    appId: "1:369200533487:web:eb31707c0de4bda2b8f01a"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const urlParams = new URLSearchParams(window.location.search);
  const userId = urlParams.get('id');
  const profileCard = document.getElementById("profileCard");

  function renderSocialLinks(socials = {}) {
    const platforms = {
      instagram: usernameOrUrl =>
        usernameOrUrl.startsWith("http")
          ? usernameOrUrl
          : `https://instagram.com/${usernameOrUrl.replace(/^@/, "")}`,
      facebook: usernameOrUrl =>
        usernameOrUrl.startsWith("http")
          ? usernameOrUrl
          : `https://facebook.com/${usernameOrUrl.replace(/^@/, "")}`,
      tiktok: usernameOrUrl =>
        usernameOrUrl.startsWith("http")
          ? usernameOrUrl
          : `https://tiktok.com/@${usernameOrUrl.replace(/^@/, "")}`
    };

    let html = "";
    for (let key in platforms) {
      if (socials[key] && socials[key].trim() !== "") {
        const link = platforms[key](socials[key]);
        const displayName = socials[key].startsWith("http")
          ? socials[key]
          : `@${socials[key].replace(/^@/, "")}`;
        html += `<a href="${link}" target="_blank" class="social-tag">${key} ${displayName}</a>`;
      }
    }
    return html || "<p>Å½Ã¡dnÃ© sociÃ¡lnÃ­ sÃ­tÄ›</p>";
  }

  if (userId) {
    const userRef = ref(db, 'users/' + userId);
    get(userRef).then(snapshot => {
      if (snapshot.exists()) {
        const user = snapshot.val();

        const specializations = Array.isArray(user.specializations)
          ? user.specializations.join(', ')
          : (typeof user.specializations === 'string' ? user.specializations : '-');

        const languages = Array.isArray(user.languages)
          ? user.languages.join(', ')
          : (typeof user.languages === 'string' ? user.languages : '-');

        profileCard.innerHTML = `
          <div class="profile-container">
            <div class="profile-left">
              <img class="profile-avatar" src="${user.profilePicture || 'https://placehold.co/300x300?text=Profil'}" alt="ProfilovÃ¡ fotka">
              <h2>${user.name || "NeznÃ¡mÃ½"} ${user.prijmeni || ""}</h2>
              <p><strong>ğŸ“ Lokalita:</strong> ${user.location || "-"}</p>
              <p><strong>ğŸ“ Telefon:</strong> ${user.phone || "-"}</p>
              <p><strong>ğŸ“§ Email:</strong> ${user.email || "-"}</p>
              <p><strong>ğŸŒ Moje sociÃ¡lnÃ­ sÃ­tÄ›:</strong></p>
              <p> </p>
              <div class="socials-container">
                ${renderSocialLinks({
                  instagram: user.instagram,
                  facebook: user.facebook,
                  tiktok: user.tiktok
                })}
              </div>
            </div>
            <div class="profile-right">
              <p class="bio-text"><strong>ğŸ§â€â™‚ï¸ O mnÄ›:</strong> ${user.bio || "-"}</p>
              <p><strong>ğŸ’ª Specializace:</strong></p>
              <div class="tag-list">
                ${(Array.isArray(user.specializations) ? user.specializations : (user.specializations || "").split(","))
                  .map(s => `<span class="tag">${s.trim()}</span>`).join("") || "-"}
              </div>
              
              <p><strong>ğŸ—£ï¸ Jazyky:</strong></p>
              <div class="tag-list">
                ${(Array.isArray(user.languages) ? user.languages : (user.languages || "").split(","))
                  .map(l => `<span class="tag">${l.trim()}</span>`).join("") || "-"}
              </div>

              <p><strong>ğŸ§  ZkuÅ¡enosti:</strong> ${user.experience || "-"} let</p>
              <p class="pricing-text"><strong>ğŸ’° Cena:</strong> ${user.pricing || "-"}</p>
            </div>
          </div>
        `;
      } else {
        profileCard.innerHTML = "<p>UÅ¾ivatel nebyl nalezen.</p>";
      }
    }).catch(error => {
      profileCard.innerHTML = `<p>Chyba naÄÃ­tÃ¡nÃ­: ${error.message}</p>`;
    });
  } else {
    profileCard.innerHTML = "<p>ChybÃ­ ID uÅ¾ivatele v URL.</p>";
  }
  </script>

  <script type="module" src="auth-navbar.js"></script>
</body>
</html>
