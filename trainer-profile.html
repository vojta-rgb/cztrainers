<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>M≈Øj tren√©rsk√Ω profil</title>

  <!-- Global site styles -->
  <link rel="stylesheet" href="style_main.css"/>

  <!-- Page-only tweaks -->
  <link rel="stylesheet" href="trainer-profile.css"/>
</head>
<body>
  <!-- NAVBAR (same structure you‚Äôre using everywhere) -->
  <nav class="navbar">
    <div class="nav-logo">
      <a href="index_main.html"><img src="CZtrainers new better.png" alt="CZTRAINERS Logo"></a>
    </div>

    <div class="nav-right">
      <!-- Profile/Login pill (text is set by auth-navbar.js) -->
      <a id="profilePill" class="nav-button profile-pill" href="register.html" aria-label="P≈ôihl√°≈°en√≠ / registrace">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="margin-right:.45rem">
          <circle cx="12" cy="8" r="4"></circle><path d="M6 20a6 6 0 0112 0"></path>
        </svg>
        <span id="pillText">Login</span>
      </a>

      <!-- desktop theme toggle -->
      <button class="theme-toggle" id="themeToggle" type="button" aria-label="P≈ôepnout motiv">
        <span id="themeIcon">‚òÄÔ∏è</span>
      </button>

      <!-- Hamburger -->
      <button class="hamburger" id="hamburger" aria-label="Menu">
        <span></span><span></span><span></span>
      </button>
    </div>

    <!-- Dropdown -->
    <div class="nav-links" id="navLinks" role="menu" aria-label="Navigace">
      <a href="o-nas.html" class="nav-button">O n√°s</a>
      <a href="login.html" class="nav-button" id="loginBtn">P≈ôihl√°≈°en√≠</a>
      <a href="#" class="nav-button" id="logoutBtn" style="display:none">Odhl√°sit se</a>

      <!-- mobile theme toggle -->
      <button class="theme-toggle" id="themeToggleMobile" type="button" aria-label="P≈ôepnout motiv (mobil)">
        <span>üåó</span>
      </button>
    </div>
  </nav>

  <!-- PAGE CONTENT -->
  <main class="tp-container">
    <!-- Header like Instagram: avatar + name + actions -->
    <section class="tp-header">
      <img id="tpAvatar" class="tp-avatar" src="https://placehold.co/200x200?text=Profil" alt="Profilov√° fotka" />
      <h1 id="tpName" class="tp-name">‚Äî</h1>

      <div class="tp-actions">
        <a class="tp-btn" href="mujprofil.html">Upravit profil</a>
        <a class="tp-btn" href="account.html">√öƒçet &amp; zabezpeƒçen√≠</a>
        <button id="logoutInline" class="tp-btn tp-btn-red" type="button">Odhl√°sit se</button>
      </div>
    </section>

    <hr class="tp-sep"/>

    <section class="tp-preview">
      <h2>N√°hled va≈°eho profilu</h2>
      <div id="profilePreview"></div>
    </section>
  </main>

  <!-- THEME + HAMBURGER (same lightweight script you use) -->
  <script>
    // Persisted theme
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark');
    }

    window.addEventListener('DOMContentLoaded', () => {
      const desktopToggle = document.getElementById('themeToggle');
      const mobileToggle  = document.getElementById('themeToggleMobile');
      const icon          = document.getElementById('themeIcon');

      function setTheme(isDark){
        document.body.classList.toggle('dark', isDark);
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        if (icon) icon.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
      }
      if (icon && document.body.classList.contains('dark')) icon.textContent = 'üåô';

      [desktopToggle, mobileToggle].forEach(btn=>{
        if (!btn) return;
        btn.addEventListener('click', () => setTheme(!document.body.classList.contains('dark')));
      });

      document.getElementById('hamburger')?.addEventListener('click', () => {
        document.getElementById('navLinks')?.classList.toggle('active');
      });
    });
  </script>

  <!-- FIREBASE: load current user + data and render header + preview -->
  <script type="module">
    import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyASK2terL9kejt9JTJr944WCFYzRkK8AGU",
      authDomain: "cztrainers-dat1.firebaseapp.com",
      databaseURL: "https://cztrainers-dat1-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "cztrainers-dat1",
      storageBucket: "cztrainers-dat1.appspot.com",
      messagingSenderId: "369200533487",
      appId: "1:369200533487:web:eb31707c0de4bda2b8f01a"
    };

    const app  = getApps().length ? getApp() : initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getDatabase(app);

    const avatarEl = document.getElementById('tpAvatar');
    const nameEl   = document.getElementById('tpName');
    const preview  = document.getElementById('profilePreview');

    function renderPreview(userData){
      const sArr = Array.isArray(userData.specializations)
        ? userData.specializations
        : (typeof userData.specializations === 'string'
            ? userData.specializations.split(',').map(s=>s.trim()).filter(Boolean)
            : []);

      const lArr = Array.isArray(userData.languages)
        ? userData.languages
        : (typeof userData.languages === 'string'
            ? userData.languages.split(',').map(s=>s.trim()).filter(Boolean)
            : []);

      preview.innerHTML = `
        <div class="profile-container">
          <div class="profile-left">
            <img class="profile-avatar" src="${userData.profilePicture || 'https://placehold.co/300x300?text=Profil'}" alt="Profilov√° fotka">
            <h3>${(userData.name||'') + ' ' + (userData.prijmeni||'')}</h3>
            <p><strong>Lokalita:</strong> ${userData.location || '-'}</p>
            <p><strong>Telefon:</strong> ${userData.phone || '-'}</p>
            <p><strong>E-mail:</strong> ${userData.email || '-'}</p>
          </div>
          <div class="profile-right">
            <p class="bio-text"><strong>O mnƒõ:</strong> ${userData.bio || '-'}</p>

            <p><strong>Specializace:</strong></p>
            <div class="tag-list">
              ${sArr.map(s => `<span class="tag">${s}</span>`).join('') || '-'}
            </div>

            <p><strong>Jazyky:</strong></p>
            <div class="tag-list">
              ${lArr.map(l => `<span class="tag">${l}</span>`).join('') || '-'}
            </div>

            <p><strong>Zku≈°enosti:</strong> ${userData.experience || '-'} let</p>
            <p class="pricing-text"><strong>Cena:</strong> ${userData.pricing || '-'}</p>
          </div>
        </div>
      `;
    }

    // Inline logout button
    document.getElementById('logoutInline')?.addEventListener('click', async () => {
      try {
        await signOut(auth);
        window.location.href = "index_main.html";
      } catch (e) {
        alert("Chyba p≈ôi odhl√°≈°en√≠: " + e.message);
      }
    });

    onAuthStateChanged(auth, async (u) => {
      if (!u) {
        // not signed in ‚Üí go to login
        window.location.href = "login.html";
        return;
      }
      // header info
      try {
        const snap = await get(ref(db, 'users/' + u.uid));
        if (snap.exists()) {
          const data = snap.val();
          avatarEl.src = data.profilePicture || 'https://placehold.co/200x200?text=Profil';
          nameEl.textContent = `${data.name || ''} ${data.prijmeni || ''}`.trim() || (u.email || 'M≈Øj profil');
          renderPreview(data);
        } else {
          nameEl.textContent = u.email || "M≈Øj profil";
          renderPreview({});
        }
      } catch (err) {
        nameEl.textContent = u.email || "M≈Øj profil";
        preview.innerHTML = `<p>Chyba naƒç√≠t√°n√≠: ${err.message}</p>`;
      }
    });
  </script>

  <!-- Shared auth/navbar logic -->
  <script type="module" src="auth-navbar.js"></script>
</body>
</html>
